<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: UniversalSentenceEncoder/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: UniversalSentenceEncoder/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// import * as tf from '@tensorflow/tfjs';
import * as USE from '@tensorflow-models/universal-sentence-encoder';
import callCallback from '../utils/callcallback';

const DEFAULTS = {
  withTokenizer: false,
}

class UniversalSentenceEncoder {
  constructor(options, callback){
    this.model = null;
    this.tokenizer = null;
    this.config = {
      withTokenizer: options.withTokenizer || DEFAULTS.withTokenizer
    };

    callCallback(this.loadModel(), callback);
  }

  /**
   * load model
   */
  async loadModel(){
    if(this.config.withTokenizer === true){
      this.tokenizer = await USE.loadTokenizer();
    } 
    this.model = await USE.load();
    return this;
  }

  /**
   * Encodes a string or array based on the USE
   * @param {*} textString 
   * @param {*} callback 
   */
  predict(textArray, callback){
    return callCallback(this.predictInternal(textArray), callback);
  }

  async predictInternal(textArray){
    try{
      const embeddings = await this.model.embed(textArray);
      const results = await embeddings.array();
      embeddings.dispose();
      return results;
    } catch(err){
      console.error(err);
      return err;
    }
  }

  /**
   * Encodes a string based on the loaded tokenizer if the withTokenizer:true
   * @param {*} textString 
   * @param {*} callback 
   */
  encode(textString, callback){
    return callCallback(this.encodeInternal(textString), callback);
  }

  async encodeInternal(textString){
    if(this.config.withTokenizer === true){
      return this.tokenizer.encode(textString);
    } 
    console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor');
    return false;
  }

}

const universalSentenceEncoder = (optionsOr, cb) => {
  const options = (typeof optionsOr === 'object') ? optionsOr : {};
  const callback = (typeof optionsOr === 'function') ? optionsOr : cb;

  return new UniversalSentenceEncoder(options, callback);
};

export default universalSentenceEncoder;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BodyPix.html">BodyPix</a></li><li><a href="Cartoon.html">Cartoon</a></li><li><a href="CharRNN.html">CharRNN</a></li><li><a href="CocoSsdBase.html">CocoSsdBase</a></li><li><a href="Cvae.html">Cvae</a></li><li><a href="DCGANBase.html">DCGANBase</a></li><li><a href="FaceApiBase.html">FaceApiBase</a></li><li><a href="ImageClassifier.html">ImageClassifier</a></li><li><a href="KMeans.html">KMeans</a></li><li><a href="KNN.html">KNN</a></li><li><a href="ObjectDetector.html">ObjectDetector</a></li><li><a href="PitchDetection.html">PitchDetection</a></li><li><a href="Pix2pix.html">Pix2pix</a></li><li><a href="PoseNet.html">PoseNet</a></li><li><a href="Sentiment.html">Sentiment</a></li><li><a href="SketchRNN.html">SketchRNN</a></li><li><a href="SoundClassifier.html">SoundClassifier</a></li><li><a href="StyleTransfer.html">StyleTransfer</a></li><li><a href="UNET.html">UNET</a></li><li><a href="Word2Vec.html">Word2Vec</a></li><li><a href="YOLOBase.html">YOLOBase</a></li></ul><h3>Global</h3><ul><li><a href="global.html#featureExtractor">featureExtractor</a></li><li><a href="global.html#loadDataset">loadDataset</a></li><li><a href="global.html#OOV_CHAR">OOV_CHAR</a></li><li><a href="global.html#readCsv">readCsv</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed Apr 22 2020 12:18:04 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
